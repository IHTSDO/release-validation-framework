
<!DOCTYPE suite SYSTEM "http://testng.org/testng-1.0.dtd" >

<suite name="script_003_DNF Medicinal Product Pack (30513011000036104)" verbose="2">

	<test name="01 Some Medicinal Product Pack exist">
        <parameter name="query" value="select count(*) from &lt;PROSPECTIVE&gt;.concept_active where id in (select sourceid from rf2_cr_transitiveclosuretable where destinationId = 30513011000036104);"/>
        <parameter name="description" value=""></parameter>
		<parameter name="qualifier" value=">"></parameter>
		<parameter name="expectedValue" value="1"/>
        <parameter name="skip" value="true"/>
        <parameter name="skip" value="true"/> <!--Will come back to expected value tests-->
        <classes>
            <class name="au.gov.nehta.test.ExpectedValueTest"/>
        </classes>
    </test>

<!-- Basic Content/Descriptions validation !-->
<!-- CONERT() required to use the qualifier -->
    <test name="02 DNF 99.8% Medicinal Product Pack are 900000000000073002|Defined|">
        <parameter name="query" value="select TRUNCATE(get_cr_PercentDefined(929360081000036101),1);"/>
		<parameter name="description" value="MPPs are almost always defined. With the exception of some packs that will subsume multipacks etc"></parameter>
		<parameter name="expectedValue" value="99.8"/>
        <parameter name="skip" value="true"/> <!--Will come back to expected value tests-->
        <classes>
            <class name="au.gov.nehta.test.ExpectedValueTest"/>
        </classes>
    </test>

    <test name="03 Medicinal Product Pack is 900000000000073002|Defined">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_active
										where id = 30513011000036104
										and definitionStatusId != 900000000000073002;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="03 All concepts with semantic tag (Medicinal Product Pack) are Descendents of 30513011000036104|Medicinal Product Pack (or itself)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.description_active
										where isActiveConcept_cr(conceptId)
										and typeId = 900000000000003001
										and SUBSTRING(term,-24,24) = BINARY '(medicinal product pack)'
										and NOT isKindOf_cr(conceptId,30513011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="04 All concepts that are Descendents of 30513011000036104|medicinal product pack have semantic tag (Medicinal Product Pack) - (except 30404011000036106|TPUU descendants)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.description_active
										where isKindOf_cr(conceptId,30513011000036104)
										and NOT isKindOf_cr(conceptId,30404011000036106)
										and typeId = 900000000000003001
										and SUBSTRING(term,-24,24) != BINARY '(medicinal product pack)';"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="05 Concept 30513011000036104|MPUU has FSN = 'medicinal product pack (medicinal product pack)'">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.description_active
										where typeId = 900000000000003001
										and conceptId = 30513011000036104
										and term != BINARY 'medicinal product pack (medicinal product pack)';"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="06a Concept 30513011000036104|MPUU has SYN = 'medicinal product pack' or 'MPP - medicinal product pack'">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.description_active
										where typeId = 900000000000013009
										and conceptId = 30513011000036104	
										and term != BINARY 'medicinal product pack'
										and term != BINARY 'MPP - medicinal product pack';"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="06b Concept 30513011000036104|MPUU has SYN = 'medicinal product pack' or 'MPP - medicinal product pack'">
        <parameter name="query" value="select get_cr_ADRS_PT(30513011000036104) = BINARY 'medicinal product pack';"/>
		<parameter name="expectedValue" value="1"/>
        <parameter name="skip" value="true"/> <!--Will come back to expected value tests-->
        <classes>
            <class name="au.gov.nehta.test.ExpectedValueTest"/>
        </classes>
    </test>
	
<!-- Defining/Source properties !-->
<!-- has MPUU !-->
	<test name="07 has MPUU (30348011000036104) relationships only have sourceId that are descendants of 30513011000036104|MPP (or MPP itself)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30348011000036104
										and NOT isKindOf_cr(sourceId,30513011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="08 has MPUU (30348011000036104) only have destinationId 30450011000036109|MPUU">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30348011000036104
										and NOT isKindOf_cr(destinationId,30450011000036109);"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="09 Every MPP has at least 1 has MPUU (30348011000036104) relationship (except 30404011000036106 [trade product pack] descendants)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_active AS C
										where isKindOf_cr(id,30513011000036104)
										and id not in (select sourceId from &lt;PROSPECTIVE&gt;.relationship_active
														  where typeId = 30348011000036104)
										and NOT isKindOf_cr(id,30404011000036106);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="10 Every has MPUU (30348011000036104) relationship IS referenced in the Unit of use quantity reference set(700000131000036101) - Except 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30348011000036104
										and sourceId != 30513011000036104
										and id not in (select referencedComponentId from rf2_cr_ccsrefset_active where refsetId = 700000131000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

<!-- 30454011000036104 has subpack !-->
	<test name="11 has subpack (30454011000036104) relationships only have sourceId that are kinds of 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and NOT isKindOf_cr(sourceId,30513011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	

	<test name="12 has subpack (30454011000036104) relationships only have destinationId that are kinds of 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and NOT isKindOf_cr(destinationId,30513011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="13 If sourceId is kind of 30513011000036104|MPP, has subpack (30454011000036104) only destinationId that are also kinds of 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and isKindOf_cr(sourceId,30513011000036104)
										and NOT isKindOf_cr(sourceId,30404011000036106)
										and isKindOf_cr(destinationId,30404011000036106);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="14 If destinationId is a 30513011000036104|MPP, all has subpack (30454011000036104) sourceId are either 30513011000036104|MPP or 30404011000036106|TPP (ie. not CTPP)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and isKindOf_cr(destinationId,30513011000036104)
										and NOT isKindOf_cr(destinationId,30404011000036106)
										and isKindOf_cr(sourceId,30537011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="15 If destinationId is kind of 30513011000036104|MPP (and Not Kind of TPP|30404011000036106), all has subpack (30454011000036104) sourceId are also kinds of 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and isKindOf_cr(destinationId,30513011000036104)
										and NOT isKindOf_cr(destinationId,30404011000036106)
										and NOT isKindOf_cr(sourceId,30513011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="16 If source is kind of 30513011000036104|MPP (and Not Kind of TPP|30404011000036106), all has subpack (30454011000036104) destinationId are also kinds of 30513011000036104|MPP (and not TPP)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and isKindOf_cr(sourceId,30513011000036104)
										and NOT isKindOf_cr(sourceId,30404011000036106)
										and NOT isKindOf_cr(destinationId,30513011000036104)
										and isKindOf_cr(destinationId,30404011000036106);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="17 Maximum of 1 has subpack (30454011000036104) for all kinds of 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										group by sourceId
										having count(*) != 1;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test> 

	<test name="16 Every has subpack (30454011000036104) relationship IS referenced in the Subpack quantity reference set(700000121000036103)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and id not in (select referencedComponentId from rf2_cr_ccirefset_active where refsetId = 700000121000036103);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

<!-- 700000061000036106 has component pack !-->

	<test name="17 has component pack (700000061000036106) relationships only have sourceId that are kinds of 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 700000061000036106
										and NOT isKindOf_cr(sourceId,30513011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	

	<test name="18 has component pack (700000061000036106) relationships only have destinationId that are kinds of 30513011000036104|MPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 700000061000036106
										and NOT isKindOf_cr(destinationId,30513011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="19 If sourceId is kind of 30513011000036104|MPP (NOT TPP), has component pack (700000061000036106) only destinationId that are also kinds of 30513011000036104|MPP (NOT TPP)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 700000061000036106
										and isKindOf_cr(sourceId,30513011000036104)
										and NOT isKindOf_cr(sourceId,30404011000036106)
										and isKindOf_cr(destinationId,30404011000036106);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>


	<test name="20 If destinationId is kind of 30513011000036104|MPP, all has component pack (700000061000036106) sourceId are also kinds of 30513011000036104|MPP (but not CTPP)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 700000061000036106
										and isKindOf_cr(destinationId,30513011000036104)
										and NOT isKindOf_cr(destinationId,30404011000036106)
										and isKindOf_cr(sourceId,30537011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<!-- general relationship constraints !-->

	<test name="21 30513011000036104|MPPs only have 		OR [116680003|Is a]  
																	OR [30348011000036104|has MPUU]  
																	OR [700000061000036106|has component pack]  
																	OR [30454011000036104|has subpack] relationships - Excluging 30404011000036106|TPP">(
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where isKindOf_cr(sourceId,30513011000036104)
										and not isKindOf_cr(sourceId,30404011000036106)
										and typeId not in (116680003,30348011000036104,700000061000036106,30454011000036104);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="22 DNF 30513011000036104|MPPs with 700000061000036106|hasComponentPack relationships, have at least 2">(
        <parameter name="query" value="select sourceId,count(id) from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 700000061000036106
										and isDescendentOf_cr(sourceId,30513011000036104) and not isDescendentOf_cr(sourceId,30404011000036106)
										group by sourceId
										having count(id) &lt; 2;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
</suite>
