<!DOCTYPE suite SYSTEM "http://testng.org/testng-1.0.dtd" >

<suite name="script_002_Miscellaneous Description Checks" verbose="2">

    <test name="04a International Units not used in PT except for bleomycin sulfate products">
        <parameter name="query" value="SELECT conceptId,
       get_cr_FSN(conceptId),
       get_cr_ADRS_PT(conceptId),
       d.effectiveTime
  FROM &lt;PROSPECTIVE&gt;.description_active d
       JOIN &lt;PROSPECTIVE&gt;.langrefset_active r ON referencedComponentId = d.id
 WHERE     refsetid = 32570271000036106
       AND r.value1 = 900000000000548007
       AND isActiveConcept_cr(conceptId)
       AND typeId = 900000000000013009
       AND isKindOf_cr(conceptId, 30506011000036107)
       AND term RLIKE 'international units'
       AND NOT isKindOf_cr(conceptId, 857781000168109)
       AND conceptId NOT IN (SELECT sourceId
                               FROM &lt;PROSPECTIVE&gt;.relationship_active
                              WHERE     isKindOf_cr(typeId,
                                                    30348011000036104)
                                    AND isKindOf_cr(destinationId,
                                                    857781000168109));"/>
        <parameter name="description" value=""></parameter>
		<parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="04b All International Unit exceptions are for bleomycin sulfate products (no maintenance unless different drugs)">
        <parameter name="query" value="SELECT conceptId, get_cr_FSN(conceptId), get_cr_ADRS_PT(conceptId)
  FROM &lt;PROSPECTIVE&gt;.description_active d
       JOIN &lt;PROSPECTIVE&gt;.langrefset_active r ON referencedComponentId = d.id
 WHERE     refsetid = 32570271000036106
       AND r.value1 = 900000000000548007
       AND isActiveConcept_cr(conceptId)
       AND typeId = 900000000000013009
       AND isKindOf_cr(conceptId, 30506011000036107)
       AND term RLIKE 'international units'
       AND conceptId NOT IN (SELECT id
                               FROM &lt;PROSPECTIVE&gt;.concept_active
                              WHERE isDescendentOf_cr(id, 857781000168109)
                             UNION
                             SELECT sourceId
                               FROM &lt;PROSPECTIVE&gt;.relationship_active
                              WHERE     destinationId IN (SELECT id
                                                            FROM &lt;PROSPECTIVE&gt;.concept_active
                                                           WHERE isDescendentOf_cr(
                                                                    id,
                                                                    857781000168109))
                                    AND isKindOf_cr(typeId,
                                                    30348011000036104));"/>
        <parameter name="description" value="Elaborate subquery, pulls the MP and MPP subtypes. These are the expected values."></parameter>
		<parameter name="resultCount" value="null"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="05 LD50 not used in PT">
        <parameter name="query" value="select conceptId, get_cr_FSN(conceptId),get_cr_ADRS_PT(conceptId)  from &lt;PROSPECTIVE&gt;.description_active
										where isActiveConcept_cr(conceptId)
										and typeId = 900000000000013009
										and isKindOf_cr(conceptId, 30506011000036107)
										and term RLIKE 'LD50';"/>
        <parameter name="description" value=""></parameter>
		<parameter name="resultCount" value="null"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="06a Kyowa units not used in PT except for 17 exceptions (test needs maintenance if count changes)">
        <parameter name="query" value="select conceptId, get_cr_FSN(conceptId),get_cr_ADRS_PT(conceptId),effectiveTime  from &lt;PROSPECTIVE&gt;.description_active
										where isActiveConcept_cr(conceptId)
										and typeId = 900000000000013009
										and isKindOf_cr(conceptId, 30506011000036107)
										and term RLIKE 'Kyowa units';"/>
        <parameter name="description" value=""></parameter>
		<parameter name="resultCount" value="5"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="06b All Kyowa units exceptions are for colaspase products (no maintenance unless different drugs)">
        <parameter name="query" value="select conceptId, get_cr_FSN(conceptId),get_cr_ADRS_PT(conceptId)  from &lt;PROSPECTIVE&gt;.description_active
										where isActiveConcept_cr(conceptId)
										and typeId = 900000000000013009
										and isKindOf_cr(conceptId, 30506011000036107)
										and term RLIKE 'Kyowa units'
										and conceptId not in 
												(select id from &lt;PROSPECTIVE&gt;.concept_active
												where isDescendentOf_cr(id, 37712011000036104)
												UNION
												select sourceId from &lt;PROSPECTIVE&gt;.relationship_active
												where destinationId in (select id from &lt;PROSPECTIVE&gt;.concept_active
																				where isDescendentOf_cr(id, 37712011000036104))
												and isKindOf_cr(typeId, 30348011000036104)
												);"/>
        <parameter name="description" value="Elaborate subquery, pulls the MP and MPP subtypes. These are the expected values."></parameter>
		<parameter name="resultCount" value="null"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

</suite>
