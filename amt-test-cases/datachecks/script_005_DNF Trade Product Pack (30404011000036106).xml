<!DOCTYPE suite SYSTEM "http://testng.org/testng-1.0.dtd" >

<suite name="script_005_DNF Trade Product Pack (30404011000036106)" verbose="2">

    <test name="01 Some Trade Product Pack exist">
        <parameter name="query" value="select count(*) from &lt;PROSPECTIVE&gt;.concept_active where id in (select sourceid from rf2_cr_transitiveclosuretable where destinationId = 30404011000036106);"/>
		<parameter name="qualifier" value=">"></parameter>
		<parameter name="expectedValue" value="1"/>
        <parameter name="skip" value="true"/>
        <parameter name="skip" value="true"/> <!--Will come back to expected value tests-->
        <classes>
            <class name="au.gov.nehta.test.ExpectedValueTest"/>
        </classes>
    </test>

<!-- Basic Content validation !-->
<!-- Voltaren tube exceptions in #2 http://jira.cti/browse/AMT-28544 -->
	 <test name="02 Trade Product Pack and all of its descendants are 900000000000073002|Defined">
        <parameter name="query" value="SELECT * FROM &lt;PROSPECTIVE&gt;.concept_active
										WHERE isKindOf_cr(id, 30404011000036106)
										AND definitionstatusid != 900000000000073002
                                        and id not in (1093401000168106,1093381000168106,33337011000036103,1165781000168101,1093371000168108,43828011000036102,1406701000168104,1406641000168107,1443351000168100,1443381000168107,1445561000168105,1445571000168104,1445591000168103,1445601000168105,1445631000168103,1445641000168107,1445661000168106,1445671000168100,1462191000168109,1462221000168103,1492621000168104,1492651000168107);"/>
        <parameter name="resultCount" value="0"/>
         <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="03 All FSNs with semantic tag (trade product pack) are descendants of 30404011000036106|Trade Product Pack (or itself)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.description_active
										where isActiveConcept_cr(conceptId)
										and typeId = 900000000000003001
										AND term REGEXP BINARY ' \\(trade product pack\\)$'
										and NOT isKindOf_cr(conceptId,30404011000036106 )
										and conceptId != 30404011000036106;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="04 Trade Product Pack and all of its descendants have FSNs with a semantic tag (trade product pack) - except CTPP">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.description_active
										WHERE isKindOf_cr(conceptid, 30404011000036106)
									    AND NOT isKindOf_cr(conceptid, 30537011000036101)
										AND typeid = 900000000000003001
										AND term NOT REGEXP BINARY ' \\(trade product pack\\)$';"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="05 Concept 30404011000036106|TPP has FSN = 'trade product pack (trade product pack)'">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.description_active
										WHERE     typeId = 900000000000003001
										AND conceptId = 30404011000036106
										AND term = BINARY 'trade product pack (trade product pack)'
										and id != 344724011000036117;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="06a Concept 30404011000036106|TPP has SYN = 'trade product pack' or 'TPP - trade product pack'">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.description_active
										WHERE     typeId = 900000000000013009
										AND conceptId = 30404011000036106
										AND term != BINARY 'trade product pack'
										AND term != BINARY 'TPP - trade product pack';"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="06b Concept 30404011000036106|TPP has SYN = 'trade product pack' or 'TPP - trade product pack'">
        <parameter name="query" value="select get_cr_ADRS_PT(30404011000036106) = BINARY 'trade product pack';"/>
		<parameter name="expectedValue" value="1"/>
        <parameter name="skip" value="true"/> <!--Will come back to expected value tests-->
        <classes>
            <class name="au.gov.nehta.test.ExpectedValueTest"/>
        </classes>
    </test>
	
	<test name="07 Trade Product Pack is a child of 30513011000036104|medicinal product pack">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE sourceid = 30404011000036106
										AND typeid = 116680003
										AND destinationid = 30513011000036104
										and id != 2914331000168126;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="09 Trade Product Pack is only a child of 30513011000036104|medicinal product pack">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE     sourceid = 30404011000036106
										AND typeid = 116680003
										AND destinationid != 30513011000036104;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
       </classes>
    </test>

<!-- Defining/Source properties !-->
<!-- has TP !-->

	<test name="10 [700000101000036108|has TP] relationships only have sourceIds that are descendants of of 30404011000036106|trade product pack (or itself)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 700000101000036108
										and NOT isKindOf_cr(sourceId,30404011000036106);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="11 [700000101000036108|has TP] relationships only have destinationIds that are children of 30560011000036108|trade product (or itself)">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE     typeId = 700000101000036108
										AND NOT isChildOf_cr(destinationid, 30560011000036108)
										AND destinationid != 30560011000036108;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="12 Trade Product Pack and its descendants have exactly one [700000101000036108|has TP] relationship">
        <parameter name="query" value="SELECT sourceid, count(*)
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 700000101000036108
										AND isKindOf_cr(sourceId, 30404011000036106)
										GROUP BY sourceid
										HAVING count(*) != 1;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="12 [700000101000036108|has TP] relationship is never grouped">
        <parameter name="query" value="SELECT * FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 700000101000036108
										AND isKindOf_cr(sourceId, 30404011000036106)
										AND relationshipgroup != 0;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

<!-- has TPUU !-->

	<test name="13 [30409011000036107|has TPUU] relationships only have sourceIds that are descendants of 30404011000036106|trade product pack (or itself)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30409011000036107
										and NOT isKindOf_cr(sourceId,30404011000036106);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="14 [30409011000036107|has TPUU] relationships only have destinationIds that are children of 30425011000036101|trade product unit of use (or itself)">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 30409011000036107
										AND NOT isKindOf_cr(destinationid, 30425011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="15 Every Trade Product Pack  has at least one [30409011000036107|has TPUU] relationship">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.concept_active
										WHERE isKindOf_cr(id, 30404011000036106)
										AND id NOT IN (SELECT sourceid
														FROM &lt;PROSPECTIVE&gt;.relationship_active
														WHERE typeId = 30409011000036107);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="16 Every [30409011000036107|has TPUU] relationship IS referenced in the Unit of use quantity reference set(700000131000036101) - except 30404011000036106|TPP and 30537011000036101|CTPP">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30409011000036107
										and sourceId not in (30404011000036106,30537011000036101)
										and id not in (select referencedComponentId from rf2_cr_ccsrefset_snapshot where active = 1 and refsetId = 700000131000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="12 Every [30409011000036107|has TPUU] relationship is always grouped">
        <parameter name="query" value="SELECT * FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 30409011000036107
										AND isKindOf_cr(sourceId, 30404011000036106)
										AND relationshipgroup = 0;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>    

<!-- has subpack !-->

	<test name="14 [30454011000036104|has subpack] relationships for TPPs only have destinationIds that are subtypes of TPP">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 30454011000036104
                                        and isKindOf_cr(sourceId, 30425011000036101) 
										AND NOT isKindOf_cr(destinationid, 30425011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="16 Every [30454011000036104|has subpack] relationship IS referenced in the Subpack quantity reference set(700000121000036103)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30454011000036104
										and id not in (select referencedComponentId from rf2_cr_ccirefset_snapshot where active = 1 and refsetId = 700000121000036103);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="12 [30454011000036104|has subpack] relationship is always grouped">
        <parameter name="query" value="SELECT * FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 30454011000036104
										AND isKindOf_cr(sourceId, 30404011000036106)
										AND relationshipgroup = 0;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>    

<!-- has subpack/componentPack !-->

		<test name="14 [700000061000036106|has componentPack] relationships for TPPs only have destinationIds that are subtypes of TPP">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 700000061000036106
                                        and isKindOf_cr(sourceId, 30425011000036101) 
										AND NOT isKindOf_cr(destinationid, 30425011000036101);"/>
        <parameter name="resultCount" value="0"/>
            <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="16 Every Concept with [700000061000036106|has componentPack] relationship has at least 2 of them">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
                                        where typeId = 700000061000036106
                                        group by sourceId
                                        having count(*) &lt; 2"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="12 [700000061000036106|has componentPack] relationship is never grouped">
        <parameter name="query" value="SELECT * FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE typeId = 700000061000036106
										AND isKindOf_cr(sourceId, 30404011000036106)
										AND relationshipgroup != 0;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>  

<!-- general relationship constraints !-->

	<test name="17 Trade Product Pack and its children only have [116680003|Is a] OR [30409011000036107|has TPUU] OR [700000101000036108|has TP] relationships OR 30454011000036104 [has subpack] OR 700000061000036106 [has component pack]">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE isKindOf_cr(sourceId, 30404011000036106)
										AND NOT isKindOf_cr(sourceId, 30537011000036101)
										AND typeId NOT IN (116680003, 30409011000036107, 700000101000036108,30454011000036104,700000061000036106);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="20 All Trade Product Pack have at least one 30513011000036104|medicinal product pack parent - except 30537011000036101|CTPP">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.concept_active
										WHERE isKindOf_cr(Id, 30404011000036106) and NOT isKindOf_cr(Id, 30537011000036101)
										AND id not in (select sourceId from &lt;PROSPECTIVE&gt;.relationship_active
													   where typeId = 116680003
														and isKindOf_cr(destinationId, 30513011000036104) and NOT isKindOf_cr(Id, 30404011000036106)
													   );"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="21 DNF 30404011000036106|TPPs with 700000061000036106|hasComponentPack relationships, have at least 2">(
        <parameter name="query" value="select sourceId,count(id) from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 700000061000036106
										and isDescendentOf_cr(sourceId,30404011000036106) and not isDescendentOf_cr(sourceId,30537011000036101)
										group by sourceId
										having count(id) &lt; 2;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
</suite>
