<!DOCTYPE suite SYSTEM "http://testng.org/testng-1.0.dtd" >

<suite name="script_005_Shared Module Validation" verbose="2">

    <test name="01 All AU Shared metadata concepts on shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_&lt;SNAPSHOT&gt;
										where id in (161771000036108,32570231000036109,32570271000036106,32570871000036105)
										and moduleId != 161771000036108;"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="02 All Au shared metadata descriptions are on shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.descriptions_&lt;SNAPSHOT&gt;
										where conceptId in (161771000036108,32570231000036109,32570271000036106,32570871000036105)
										and moduleId != 161771000036108 and id != 108642491000036119;"/>
        <parameter name="description" value="108642491000036119 is old retired description. Doesn't need to be shared"></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="03 All Au shared metadata relationships are on shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_&lt;SNAPSHOT&gt;
										where sourceId in (161771000036108,32570231000036109,32570271000036106,32570871000036105)
										and moduleId != 161771000036108;"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="03a Any core model component concepts only have Model Component, or AU shared relationships">
        <parameter name="query" value="select id from &lt;PROSPECTIVE&gt;.concept_active
										where moduleId = 900000000000012004
										and id not in (select sourceId from &lt;PROSPECTIVE&gt;.relationship_active where moduleId in (900000000000012004,161771000036108)) and id != 900000000000441003;"/>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="04 ADRS entries for shared metadata are on the shared module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.langrefset_&lt;SNAPSHOT&gt;
										where refsetId = 32570271000036106
										and referencedComponentId in (select id from &lt;PROSPECTIVE&gt;.descriptions_&lt;SNAPSHOT&gt;
										where conceptId in (161771000036108,32570231000036109,32570271000036106,32570871000036105))
										and moduleId != 161771000036108;"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="05 Only the 20 expected concepts exist on the shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_&lt;SNAPSHOT&gt;
										where moduleId = 161771000036108
										and id not in (410670007,161771000036108,32570231000036109,32570271000036106,32570871000036105,32570661000036101,32570701000036108,1445101000168103,1445111000168100,1445121000168107,1445131000168105,1445141000168101,1445151000168104,1445161000168102,1445171000168108,1445181000168106,1445191000168109,541000168105,551000168107,561000168109)
										and effectiveTime > 20180930;"/>
        <parameter name="description" value="Updated effectiveTime Sept 2019, to account for inclusion of 255260001|Following (attribute)|"></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="06 Only descriptions for concepts on the shared or metadata module exist on the shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.descriptions_&lt;SNAPSHOT&gt;
										where moduleId = 161771000036108
										and conceptId not in (select id from &lt;PROSPECTIVE&gt;.concept_&lt;SNAPSHOT&gt; where moduleId in (161771000036108,900000000000012004));"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="07 Only relationships for concepts on the shared or metadata module exist on the shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_&lt;SNAPSHOT&gt;
										where moduleId = 161771000036108
										and sourceId not in (select id from &lt;PROSPECTIVE&gt;.concept_&lt;SNAPSHOT&gt; where moduleId in (161771000036108,900000000000012004));"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
    <test name="08 All active concepts on the shared or metadata module are subtypes of 900000000000441003 | SNOMED CT Model Component | ">
            <parameter name="query" value="select id,get_cr_FSN(id) from &lt;PROSPECTIVE&gt;.concept_active
                                        where moduleId = 161771000036108 
                                        and not isKindOf_cr(id, 900000000000441003);"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="09 All Au shared metadata relationship concrete values are on shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_concrete_value_&lt;SNAPSHOT&gt;
										where sourceId in (161771000036108,32570231000036109,32570271000036106,32570871000036105)
										and moduleId != 161771000036108;"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="10 Any core model component concepts only have Model Component, or AU shared relationship concrete values">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_active where moduleId = 900000000000012004
                                        and id IN (select sourceId from &lt;PROSPECTIVE&gt;.relationship_concrete_value_active where moduleId not in (900000000000012004,161771000036108));"/>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

    <test name="11 Only relationship concrete values for concepts on the shared or metadata module exist on the shared metadata module">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_concrete_value_active where moduleId in (900000000000012004,161771000036108)
                                        AND sourceId NOT IN (select id from &lt;PROSPECTIVE&gt;.concept_active where moduleId = 900000000000012004 );"/>
        <parameter name="description" value=""></parameter>
        <parameter name="resultCount" value="null"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

</suite>

