<!DOCTYPE suite SYSTEM "http://testng.org/testng-1.0.dtd" >

<suite name="script_004_DNF Trade Product Unit of Use (30425011000036101)" verbose="2">

    <test name="01 Some Trade Product Unit of Use exist">
        <parameter name="query" value="select count(*) from &lt;PROSPECTIVE&gt;.concept_active where id in (select sourceid from rf2_cr_transitiveclosuretable where destinationId = 30425011000036101);"/>
		<parameter name="qualifier" value=">"></parameter>
		<parameter name="expectedValue" value="1"/>
        <parameter name="skip" value="true"/>
        <parameter name="skip" value="true"/> <!--Will come back to expected value tests-->
        <classes>
            <class name="au.gov.nehta.test.ExpectedValueTest"/>
        </classes>
    </test>

<!-- Basic Content validation !-->

	<test name="03 All concepts with semantic tag (trade product unit of use) are Types of 30425011000036101|trade product unit of use only">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.description_active
										where isActiveConcept_cr(conceptId)
										and typeId = 900000000000003001
										AND term REGEXP BINARY ' \\(trade product unit of use\\)$' 
										and NOT (isKindOf_cr(conceptId, 30425011000036101) AND NOT isKindOf_cr(conceptId, 30537011000036101));"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="04 Trade Product Unit of Use and all of its descendants have FSNs with a semantic tag (trade product unit of use)">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.description_active
										WHERE (isKindOf_cr(conceptid, 30425011000036101)
										OR conceptid = 30425011000036101)
										AND typeid = 900000000000003001
										AND term NOT REGEXP BINARY ' \\(trade product unit of use\\)$';"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="05 Concept 30425011000036101|TPUU has FSN = 'trade product unit of use (trade product unit of use)'">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.description_active
										WHERE typeId = 900000000000003001
										AND conceptId = 30425011000036101
										AND term != BINARY 'trade product unit of use (trade product unit of use)';"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="06a Concept 30425011000036101|TPUU has SYN = 'trade product unit of use' or 'TPUU - trade product unit of use'">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.description_active
										WHERE typeId = 900000000000013009
										AND conceptId = 30425011000036101
										AND term != BINARY 'trade product unit of use'
										AND term != BINARY 'TPUU - trade product unit of use';"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="06b Concept 30425011000036101|TPUU has SYN = 'trade product unit of use' or 'TPUU - trade product unit of use'">
        <parameter name="query" value="select get_cr_ADRS_PT(30425011000036101) = BINARY 'trade product unit of use';"/>
		<parameter name="expectedValue" value="1"/>
        <parameter name="skip" value="true"/> <!--Will come back to expected value tests-->
        <classes>
            <class name="au.gov.nehta.test.ExpectedValueTest"/>
        </classes>
    </test>
	
	<test name="07 Trade Product Unit of Use is a child of 30560011000036108|trade product">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE sourceid = 30425011000036101
										AND typeid = 116680003
										AND destinationid = 30560011000036108
										and id != 2914551000168125;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>
	
	<test name="08 Trade Product Unit of Use is a child of 30450011000036109|medicinal product unit of use">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE sourceid = 30425011000036101
										AND typeid = 116680003
										AND destinationid = 30450011000036109
										and id != 2914661000168127;"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
       </classes>
    </test>
	

	<test name="10 Trade Product Unit of Use is only a child of 30450011000036109|medicinal product unit of use OR 30560011000036108|trade product">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.relationship_active
										WHERE sourceid = 30425011000036101
										AND typeid = 116680003
										AND NOT destinationid in (30450011000036109,30560011000036108);"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
       </classes>
    </test>

<!-- Defining/Source properties !-->
<!-- has manufactured dose form !-->



<!-- Destination properties !-->

	<test name="12 All children of Trade Product Unit of Use are the destination of at least one [30409011000036107|has TPUU] relationship">
        <parameter name="query" value="SELECT *
										FROM &lt;PROSPECTIVE&gt;.concept_active
										WHERE isChildOf_cr(Id, 30425011000036101)
										AND id NOT IN (SELECT destinationid
														FROM &lt;PROSPECTIVE&gt;.relationship_active
														WHERE typeId = 30409011000036107);"/>
        <parameter name="resultCount" value="0"/>
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test> 

	<test name="21 All Trade Product Unit of Use are the child of at least one 30450011000036109 [medicinal product unit of use]">
        <parameter name="query" value="SELECT * FROM &lt;PROSPECTIVE&gt;.concept_active
										WHERE isKindOf_cr(Id, 30425011000036101)
										AND id not in (select sourceId from &lt;PROSPECTIVE&gt;.relationship_active
													   where typeId = 116680003
														and isKindOf_cr(destinationId, 30450011000036109) and NOT isKindOf_cr(destinationId, 30425011000036101)
													   );"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test> 

<!-- general relationship constraints !-->

	<test name="13 [116680003|Is a] relationships of children of Trade Product Unit of Use concepts only have destinationIds that are children of 30560011000036108|trade product or 30450011000036109|medicinal product unit of use Concepts">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where isDescendentOf_cr(sourceId, 30425011000036101)
										and typeId = 116680003
										and destinationid != 30425011000036101
										and NOT isChildOf_cr(destinationid, 30560011000036108)
										and not (
												isDescendentOf_cr(destinationid, 30450011000036109)
												AND NOT isKindOf_cr(destinationid, 30425011000036101)
												);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

<!-- Defining/Source properties !-->
<!-- has intended active ingredient !-->

	<test name="14 Every TPUU has at least 1 has intended active ingredient(700000081000036101) relationship">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_active AS C
										where isKindOf_cr(id,30425011000036101)
										and id not in (select sourceId from &lt;PROSPECTIVE&gt;.relationship_active
														  where typeId = 700000081000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="15 Every TPUU has at least 1 has manufactured dose form(30523011000036108) relationship">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_active AS C
										where id not in (select sourceId from &lt;PROSPECTIVE&gt;.relationship_active
														  where typeId = 30523011000036108)
										and isKindOf_cr(id,30425011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="16 Every TPUU has Exactly 1 has manufactured dose form(30523011000036108) relationship">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30523011000036108
										and isKindOf_cr(sourceId,30425011000036101)
										group by sourceId
										having count(typeId) != 1;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="17 Every Kind of TPUU has at least 1 has unit of use(30548011000036101) relationship">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.concept_active AS C
										where isKindOf_cr(id,30425011000036101)
										and id not in (select sourceId from &lt;PROSPECTIVE&gt;.relationship_active
														  where typeId = 30548011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="18 Every TPUU has Exactly 1 has unit of use(30548011000036101) relationship">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 30548011000036101
										and isKindOf_cr(sourceId,30425011000036101)
										group by sourceId
										having count(typeId) != 1;"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

<!-- general relationship constraints !-->

	<test name="19 ALL TPUU only have [700000081000036101|has intended active ingredient] 
																	OR [116680003|Is a]  
																	OR [30364011000036101|has Australian BoSS]  
																	OR [30523011000036108|has manufactured dose form]  
																	OR [30548011000036101|has unit of use] relationships">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where isKindOf_cr(sourceId,30425011000036101)
										and typeId not in (700000081000036101,116680003,30364011000036101,30523011000036108,30548011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test>

	<test name="20 DNF All TPUUs are disjoint (TPUUs aren't subtypes of other TPUUs)">
        <parameter name="query" value="select * from &lt;PROSPECTIVE&gt;.relationship_active
										where typeId = 116680003
										AND isDescendentof_cr(sourceId,30425011000036101)
										AND isDescendentof_cr(destinationId,30425011000036101);"/>
        <parameter name="resultCount" value="0"/>
        <parameter name="skip" value="true"/> <!--Uses a function or proc that needs refactoring-->
        <classes>
            <class name="au.gov.nehta.test.ResultCountTest"/>
        </classes>
    </test> 

</suite>
